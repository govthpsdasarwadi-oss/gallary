<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<title>Dasarwadi School Gallery</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Segoe UI;background:#000;color:#fff;overflow:hidden}
img{pointer-events:none}
header{padding:20px;text-align:center;font-size:34px;font-weight:bold;
background:#0a3d62;border-bottom:2px solid #3498db;cursor:pointer}
.rainbow-text{
background:linear-gradient(270deg,#ff0000,#ff7300,#ffeb00,#47ff00,#00ffd5,#002bff,#7a00ff,#ff00c8,#ff0000);
background-size:1600% 1600%;
animation:rainbow 10s linear infinite;
-webkit-background-clip:text;
-webkit-text-fill-color:transparent}
@keyframes rainbow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

.slider{width:100vw;height:calc(100vh - 90px);overflow:hidden}
.slides{display:flex;height:100%;transition:.8s}
.slides img{width:100vw;height:100%;object-fit:contain}

.full-btn{position:fixed;right:10px;bottom:10px;background:#27ae60;color:#fff;
border:none;padding:10px 15px;border-radius:8px;font-weight:bold;cursor:pointer}

#admin{display:none;position:fixed;inset:0;background:#f4f7f6;color:#333;
z-index:999;padding:15px;overflow:auto}
.admin-card{background:#fff;padding:20px;border-radius:20px}

.upload-row{display:flex;gap:10px;margin-bottom:10px}
button{padding:10px;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
.save-btn{background:#0a3d62;color:#fff}
.multi-btn{background:#16a085;color:#fff}
.del-btn{background:#e74c3c;color:#fff}
.close-btn{background:#777;color:#fff;width:100%}

#thumbs{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.thumb-wrapper{border:1px solid #ccc;border-radius:8px;overflow:hidden}
.thumb{width:100%;aspect-ratio:4/3;object-fit:cover}
.btn-group{display:flex}
.btn-group button{flex:1;font-size:12px}
</style>
</head>

<body oncontextmenu="return false">

<header id="title">
<span class="rainbow-text">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø Gallery</span>
</header>

<div class="slider">
  <div class="slides" id="slides"></div>
</div>

<button class="full-btn" onclick="toggleFullscreen()">‚õ∂ Full Screen</button>

<div id="admin">
<div class="admin-card">
<h3>Admin Panel</h3>

<div class="upload-row">
<input type="file" id="singleFile" accept="image/*">
<button class="save-btn" onclick="uploadSingle()">Upload</button>
</div>

<div class="upload-row">
<input type="file" id="multiFile" accept="image/*" multiple>
<button class="multi-btn" onclick="uploadMultiple()">Multi Upload</button>
</div>

<div id="info"></div>
<div id="thumbs"></div>

<button class="close-btn" onclick="admin.style.display='none'">Close</button>
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const STORAGE_LIMIT_MB = 100;

const firebaseConfig = {
  apiKey: "AIzaSyBb4fvEag4UaBiiIClR2KJLo6XFyyQlAHU",
  databaseURL: "https://my-school-7ed03-default-rtdb.asia-southeast1.firebasedatabase.app"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ref = db.ref("gallery");

const slides = document.getElementById("slides");
const thumbs = document.getElementById("thumbs");
let images = [];

ref.on("value", s=>{
  images = s.val() || [];
  render();
});

function render(){
  slides.innerHTML = images.map(i=>`<img src="${i}">`).join("");
  thumbs.innerHTML = images.map((i,x)=>`
  <div class="thumb-wrapper">
    <img class="thumb" src="${i}">
    <div class="btn-group">
      <button onclick="moveUp(${x})">‚¨Ü</button>
      <button onclick="moveDown(${x})">‚¨á</button>
      <button onclick="saveImg(${x})">üíæ</button>
      <button class="del-btn" onclick="deleteImg(${x})">‚ùå</button>
    </div>
  </div>`).join("");

  calcStorage();
}

function calcStorage(){
  let bytes=0;
  images.forEach(i=>bytes+=i.length*0.75);
  let used=(bytes/1024/1024).toFixed(2);
  let left=(STORAGE_LIMIT_MB-used).toFixed(2);
  info.innerHTML=`<b>Photos:</b> ${images.length}<br>
<b>Used:</b> ${used} MB<br>
<b>Left:</b> ${left>0?left:0} MB`;
}

function uploadSingle(){
  const f=singleFile.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=e=>{
    images.push(e.target.result);
    ref.set(images);
  };
  r.readAsDataURL(f);
}

function uploadMultiple(){
  [...multiFile.files].forEach(f=>{
    const r=new FileReader();
    r.onload=e=>{
      images.push(e.target.result);
      ref.set(images);
    };
    r.readAsDataURL(f);
  });
}

function deleteImg(i){
  if(confirm("Delete image?")){
    images.splice(i,1);
    ref.set(images);
  }
}

function saveImg(i){
  const a=document.createElement("a");
  a.href=images[i];
  a.download=`school_image_${i+1}.jpg`;
  a.click();
}

function moveUp(i){
  if(i==0)return;
  [images[i],images[i-1]]=[images[i-1],images[i]];
  ref.set(images);
}
function moveDown(i){
  if(i==images.length-1)return;
  [images[i],images[i+1]]=[images[i+1],images[i]];
  ref.set(images);
}

let idx=0;
setInterval(()=>{
  if(images.length<2)return;
  idx=(idx+1)%images.length;
  slides.style.transform=`translateX(-${idx*100}vw)`;
},4000);

let c=0,t;
title.onclick=()=>{
  c++;clearTimeout(t);
  if(c==5){
    if(prompt("Admin Password")==="1234")admin.style.display="block";
    c=0;
  }
  t=setTimeout(()=>c=0,1500);
};

function toggleFullscreen(){
  document.fullscreenElement?
  document.exitFullscreen():
  document.documentElement.requestFullscreen();
}
</script>
</body>
</html>

