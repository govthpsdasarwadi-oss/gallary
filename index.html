<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<title>Dasarwadi School Gallery - Universal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
    /* Base Setup */
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: #000; color: white; overflow: hidden; }
    
    header { 
        background: #0a3d62; 
        padding: 15px; 
        text-align: center; 
        font-weight: bold; 
        font-size: clamp(14px, 4vw, 20px); /* Adjusts text size for mobile/PC */
        cursor: pointer; 
        border-bottom: 2px solid #3498db;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        z-index: 10;
        position: relative;
    }

    /* Full-Screen Slider Logic */
    .slider { width: 100vw; height: calc(100vh - 60px); position: relative; overflow: hidden; }
    .slides { display: flex; height: 100%; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    
    .slides img { 
        width: 100vw; 
        height: 100%; 
        object-fit: contain; /* Keeps whole photo visible without cropping */
        background: #000; 
        flex-shrink: 0; 
    }

    /* Admin Panel Styling */
    #admin { 
        display: none; 
        position: fixed; 
        top: 0; left: 0; 
        width: 100%; height: 100%; 
        background: rgba(244, 247, 246, 0.95); 
        color: #333; 
        z-index: 1000; 
        padding: 15px; 
        box-sizing: border-box; 
        overflow-y: auto; 
    }
    
    .admin-card { 
        background: white; 
        padding: 20px; 
        border-radius: 15px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
        max-width: 600px; 
        margin: 20px auto; 
    }
    
    .upload-box { 
        background: #eef2f3; 
        padding: 20px; 
        border-radius: 12px; 
        margin-bottom: 20px; 
        border: 2px dashed #0a3d62; 
        text-align: center; 
    }

    button { 
        width: 100%; 
        padding: 14px; 
        margin: 8px 0; 
        border-radius: 10px; 
        border: none; 
        font-size: 16px; 
        font-weight: bold; 
        cursor: pointer; 
        transition: opacity 0.2s;
    }
    
    button:active { opacity: 0.7; }
    .save-btn { background: #0a3d62; color: white; }
    .close-btn { background: #95a5a6; color: white; }
    
    /* Responsive Grid for Thumbnails */
    #thumbs { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
        gap: 12px; 
        margin-top: 15px; 
    }
    
    .thumb-wrapper { 
        position: relative; 
        border-radius: 10px; 
        overflow: hidden; 
        background: #ddd; 
        border: 1px solid #ccc; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    img.thumb { width: 100%; aspect-ratio: 1/1; object-fit: cover; display: block; }
    .del-btn { background: #e74c3c; color: white; padding: 8px; font-size: 11px; width: 100%; border-radius: 0; }
    
    /* Loading Overlay */
    #loading-overlay { 
        display: none; 
        position: fixed; 
        top:0; left:0; 
        width:100%; height:100%; 
        background: rgba(0,0,0,0.85); 
        z-index: 2000; 
        flex-direction: column; 
        justify-content: center; 
        align-items: center; 
        color: white; 
        text-align: center;
    }
</style>
</head>

<body>

<div id="loading-overlay">
    <div style="font-size: 20px; margin-bottom: 10px;">‚òÅÔ∏è Sending to Cloud...</div>
    <div id="progressText" style="font-size: 16px; color: #3498db; font-weight: bold;">0%</div>
</div>

<header id="title">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø Gallery</header>

<div class="slider">
    <div class="slides" id="slides"></div>
</div>

<div id="admin">
    <div class="admin-card">
        <h3 style="margin-top:0;">Admin Control Panel</h3>
        <div class="upload-box">
            <p style="margin-top:0; font-size:14px;">Select a photo to add to the school gallery</p>
            <input type="file" id="file" accept="image/*" style="margin-bottom:10px;">
            <button class="save-btn" onclick="uploadToFirebase()">üöÄ Start Upload</button>
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px;">
            <span style="font-weight:bold;">Gallery Management</span>
            <span id="imgCount" style="background:#0a3d62; color:white; padding:2px 10px; border-radius:10px; font-size:12px;">0 Photos</span>
        </div>

        <div id="thumbs"></div>
        <button class="close-btn" onclick="closeAdmin()" style="margin-top:20px;">Close Panel</button>
    </div>
</div>

<script>
// Your Verified Configuration
const firebaseConfig = {
  apiKey: "AIzaSyD_z7J_MrG5yEv_zJYmt_sHpXeeF76doBE",
  authDomain: "gallary-400ef.firebaseapp.com",
  projectId: "gallary-400ef",
  storageBucket: "gallary-400ef.firebasestorage.app",
  messagingSenderId: "136788870871",
  appId: "1:136788870871:web:7c7686952357bd2eabd292"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

let images = [];
const ADMIN_PASSWORD = "1234"; 

// Real-time Cloud Sync
db.collection("school_gallery").orderBy("createdAt", "desc").onSnapshot((snapshot) => {
    images = snapshot.docs.map(doc => ({ id: doc.id, url: doc.data().url }));
    renderUI();
});

function renderUI() {
    const slidesDiv = document.getElementById("slides");
    const thumbsDiv = document.getElementById("thumbs");

    // Main Slider
    slidesDiv.innerHTML = images.length === 0 ? 
        "<div style='width:100vw; height:100%; display:flex; align-items:center; justify-content:center; color:#666;'>No photos found. Admin, please upload.</div>" : 
        images.map(img => `<img src="${img.url}" loading="lazy">`).join('');
    
    // Admin Management Grid
    thumbsDiv.innerHTML = images.map((img) => `
        <div class="thumb-wrapper">
            <img class="thumb" src="${img.url}">
            <button class="del-btn" onclick="deleteFromFirebase('${img.id}', '${img.url}')">REMOVE</button>
        </div>
    `).join('');

    document.getElementById("imgCount").innerText = `${images.length} Photos`;
    startAutoSlide();
}

function uploadToFirebase() {
    const fileInput = document.getElementById("file");
    const file = fileInput.files[0];
    if (!file) return alert("Please select a photo first!");

    const loading = document.getElementById("loading-overlay");
    const progressText = document.getElementById("progressText");
    loading.style.display = "flex";

    const fileName = Date.now() + "_" + file.name;
    const storageRef = storage.ref('gallery/' + fileName);
    const uploadTask = storageRef.put(file);

    uploadTask.on('state_changed', 
        (snapshot) => {
            const progress = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
            progressText.innerText = `${progress}% Uploaded`;
        }, 
        (error) => {
            alert("Upload Error: " + error.message);
            loading.style.display = "none";
        }, 
        async () => {
            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
            await db.collection("school_gallery").add({
                url: downloadURL,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            fileInput.value = "";
            loading.style.display = "none";
            alert("Upload Successful!");
        }
    );
}

async function deleteFromFirebase(id, url) {
    if (!confirm("Are you sure you want to delete this photo?")) return;
    try {
        await db.collection("school_gallery").doc(id).delete();
        await storage.refFromURL(url).delete();
    } catch (e) { alert("Delete failed: " + e.message); }
}

let i = 0, intv;
function startAutoSlide() {
    clearInterval(intv);
    if (images.length < 2) return;
    intv = setInterval(() => {
        i = (i + 1) % images.length;
        document.getElementById("slides").style.transform = `translateX(-${i * 100}vw)`;
    }, 5000);
}

// Secret Admin Access (5 Taps)
let clickCount = 0, timer;
document.getElementById("title").onclick = () => {
    clickCount++;
    clearTimeout(timer);
    if (clickCount === 5) {
        clickCount = 0;
        let pw = prompt("Admin Password Required:");
        if (pw === ADMIN_PASSWORD) {
            document.getElementById("admin").style.display = "block";
        } else if (pw !== null) {
            alert("Incorrect Password.");
        }
    }
    timer = setTimeout(() => clickCount = 0, 1500);
};

function closeAdmin() { document.getElementById("admin").style.display = "none"; }
</script>
</body>
</html>
