<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<title>Dasarwadi School Gallery - Direct Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: #000; color: white; overflow: hidden; }
    
    /* Responsive Header */
    header { 
        background: #0a3d62; 
        padding: 15px; 
        text-align: center; 
        font-weight: bold; 
        font-size: clamp(14px, 4vw, 20px); 
        cursor: pointer; 
        border-bottom: 2px solid #3498db;
        position: relative;
        z-index: 10;
    }

    /* Universal Slider - Fixed black bars issue */
    .slider { width: 100vw; height: calc(100vh - 60px); position: relative; overflow: hidden; background: #000; }
    .slides { display: flex; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .slides img { 
        width: 100vw; 
        height: 100%; 
        object-fit: contain; /* Shows full image on any screen */
        flex-shrink: 0; 
    }

    /* Admin Panel */
    #admin { 
        display: none; 
        position: fixed; 
        top: 0; left: 0; 
        width: 100%; height: 100%; 
        background: rgba(244, 247, 246, 0.98); 
        color: #333; 
        z-index: 1000; 
        padding: 15px; 
        box-sizing: border-box; 
        overflow-y: auto; 
    }
    
    .admin-card { 
        background: white; 
        padding: 20px; 
        border-radius: 15px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        max-width: 550px; 
        margin: 10px auto; 
    }
    
    .upload-box { 
        background: #f0f4f8; 
        padding: 20px; 
        border-radius: 12px; 
        margin-bottom: 20px; 
        border: 2px dashed #0a3d62; 
        text-align: center; 
    }

    button { 
        width: 100%; 
        padding: 15px; 
        margin: 5px 0; 
        border-radius: 10px; 
        border: none; 
        font-size: 16px; 
        font-weight: bold; 
        cursor: pointer; 
    }
    
    .save-btn { background: #0a3d62; color: white; }
    .close-btn { background: #bdc3c7; color: #333; }
    
    /* Responsive Management Grid */
    #thumbs { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
        gap: 10px; 
        margin-top: 15px; 
    }
    
    .thumb-wrapper { 
        position: relative; 
        border-radius: 8px; 
        overflow: hidden; 
        border: 1px solid #ddd;
    }
    
    img.thumb { width: 100%; aspect-ratio: 1/1; object-fit: cover; display: block; }
    .del-btn { background: #e74c3c; color: white; padding: 6px; font-size: 10px; width: 100%; border-radius: 0; }
    
    /* Direct Upload Loading Overlay */
    #loading-overlay { 
        display: none; 
        position: fixed; 
        top:0; left:0; 
        width:100%; height:100%; 
        background: rgba(0,0,0,0.9); 
        z-index: 2000; 
        flex-direction: column; 
        justify-content: center; 
        align-items: center; 
        color: white; 
    }
    
    .progress-bar-container {
        width: 80%;
        height: 10px;
        background: #333;
        border-radius: 5px;
        margin-top: 15px;
        overflow: hidden;
    }
    
    #progress-fill {
        width: 0%;
        height: 100%;
        background: #3498db;
        transition: width 0.3s;
    }
</style>
</head>

<body>

<div id="loading-overlay">
    <div style="font-size: 18px;">Sending Original Photo...</div>
    <div class="progress-bar-container">
        <div id="progress-fill"></div>
    </div>
    <div id="progressText" style="margin-top: 10px; font-weight: bold;">0%</div>
</div>

<header id="title">‡≤∏‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø ‡≤™‡≥ç‡≤∞‡≤æ‡≤•‡≤Æ‡≤ø‡≤ï ‡≤∂‡≤æ‡≤≤‡≥Ü ‡≤¶‡≤æ‡≤∏‡≤∞‡≤µ‡≤æ‡≤°‡≤ø Gallery</header>

<div class="slider">
    <div class="slides" id="slides"></div>
</div>

<div id="admin">
    <div class="admin-card">
        <h3 style="margin:0 0 15px 0;">Admin Panel</h3>
        <div class="upload-box">
            <input type="file" id="file" accept="image/*" style="width: 100%; margin-bottom: 10px;">
            <button class="save-btn" onclick="uploadToFirebase()">üöÄ Direct Upload</button>
        </div>
        
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="font-weight:bold;">Manage Photos</span>
            <span id="imgCount" style="font-size:12px; opacity:0.7;">0 Photos</span>
        </div>

        <div id="thumbs"></div>
        <button class="close-btn" onclick="closeAdmin()" style="margin-top:20px;">Exit Admin</button>
    </div>
</div>

<script>
// Your App Config
const firebaseConfig = {
  apiKey: "AIzaSyD_z7J_MrG5yEv_zJYmt_sHpXeeF76doBE",
  authDomain: "gallary-400ef.firebaseapp.com",
  projectId: "gallary-400ef",
  storageBucket: "gallary-400ef.firebasestorage.app",
  messagingSenderId: "136788870871",
  appId: "1:136788870871:web:7c7686952357bd2eabd292"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

let images = [];
const ADMIN_PASSWORD = "1234"; 

// Auto-Sync Gallery
db.collection("school_gallery").orderBy("createdAt", "desc").onSnapshot((snapshot) => {
    images = snapshot.docs.map(doc => ({ id: doc.id, url: doc.data().url }));
    renderUI();
});

function renderUI() {
    const slidesDiv = document.getElementById("slides");
    const thumbsDiv = document.getElementById("thumbs");

    slidesDiv.innerHTML = images.length === 0 ? 
        "<div style='width:100vw; height:100%; display:flex; align-items:center; justify-content:center;'>Empty Gallery</div>" : 
        images.map(img => `<img src="${img.url}">`).join('');
    
    thumbsDiv.innerHTML = images.map((img) => `
        <div class="thumb-wrapper">
            <img class="thumb" src="${img.url}">
            <button class="del-btn" onclick="deleteFromFirebase('${img.id}', '${img.url}')">DELETE</button>
        </div>
    `).join('');

    document.getElementById("imgCount").innerText = `${images.length} Photos`;
    startAutoSlide();
}

function uploadToFirebase() {
    const fileInput = document.getElementById("file");
    const file = fileInput.files[0];
    if (!file) return alert("Select photo!");

    const loading = document.getElementById("loading-overlay");
    const progressFill = document.getElementById("progress-fill");
    const progressText = document.getElementById("progressText");
    
    loading.style.display = "flex";

    const fileName = Date.now() + "_" + file.name;
    const storageRef = storage.ref('gallery/' + fileName);
    const uploadTask = storageRef.put(file);

    uploadTask.on('state_changed', 
        (snapshot) => {
            const progress = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
            progressFill.style.width = progress + "%";
            progressText.innerText = progress + "%";
        }, 
        (error) => {
            alert("Error: " + error.message);
            loading.style.display = "none";
        }, 
        async () => {
            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
            await db.collection("school_gallery").add({
                url: downloadURL,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            fileInput.value = "";
            loading.style.display = "none";
            alert("Successfully uploaded!");
        }
    );
}

async function deleteFromFirebase(id, url) {
    if (!confirm("Delete permanently?")) return;
    try {
        await db.collection("school_gallery").doc(id).delete();
        await storage.refFromURL(url).delete();
    } catch (e) { alert("Error: " + e.message); }
}

let i = 0, intv;
function startAutoSlide() {
    clearInterval(intv);
    if (images.length < 2) return;
    intv = setInterval(() => {
        i = (i + 1) % images.length;
        document.getElementById("slides").style.transform = `translateX(-${i * 100}vw)`;
    }, 5000);
}

// 5 Taps for Admin + Password
let clickCount = 0, timer;
document.getElementById("title").onclick = () => {
    clickCount++;
    clearTimeout(timer);
    if (clickCount === 5) {
        clickCount = 0;
        let pw = prompt("Admin Password:");
        if (pw === ADMIN_PASSWORD) {
            document.getElementById("admin").style.display = "block";
        }
    }
    timer = setTimeout(() => clickCount = 0, 1500);
};

function closeAdmin() { document.getElementById("admin").style.display = "none"; }
</script>
</body>
</html>
